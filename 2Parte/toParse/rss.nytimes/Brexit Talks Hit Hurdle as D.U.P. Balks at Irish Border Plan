LONDON — Britain’s divorce negotiations with the European Union hit a major snag on Monday, when a hard-line Northern Ireland party that is a crucial ally of Prime Minister Theresa May pulled its support at the last minute from an agreement on the future of the border between the United Kingdom and Ireland.

The abrupt decision, which appeared to take Mrs. May by surprise as she held talks in Brussels, derailed a draft deal between Britain and the European Union that is a prerequisite for moving on to the next stage of negotiations.

It denied Mrs. May a much-needed breakthrough in the stalled talks. It frustrated leaders of the European Union, who increasingly appear to have the upper hand in the discussions. And it underscored yet again Mrs. May’s weakness at home, and the complexity of the task facing her as Britain tries to unscramble more than four decades of European integration.

“Once again Theresa May has come out of Brexit talks with her tail between her legs,” said Tom Brake, a member of Parliament from the Liberal Democrats, an opposition party. “As each day goes by, it becomes clearer that the best deal for everyone is to stay in Europe. The people of the U.K. must be given a vote on the deal and an opportunity to exit from Brexit.”

To move the talks forward, Britain and the European Union were supposed to make “sufficient progress” by the end of next week on three areas: Britain’s outstanding financial commitments to the other 27 nations in the bloc; the rights of European citizens living in Britain; and the status of the border between Northern Ireland and Ireland, which will remain in the European Union.

Mrs. May had already made serious concession on two of the issues.

Last week, Britain agreed in principle to write a divorce check estimated at $47 billion to $53 billion, more than double its initial offer.

And Britain was expected to concede that the European Court of Justice — the highest arbiter of European Union law and an institution loathed by hard-line British nationalists — could have a possible role in adjudicating the rights of European Union citizens after Brexit.

But then the Irish question arose.

Mrs. May’s government appeared to have reached a compromise that would effectively allow Northern Ireland to behave as though it were to remain in the single market and customs union, while technically leaving, along with the rest of the United Kingdom.

The compromise was intended to help prevent the re-imposition of customs checks at the frontier, the land border between the United Kingdom and the European Union. That so-called “hard border” was once a major source of sectarian friction; it was dismantled after the signing of the Good Friday agreement in 1998 that ended decades of violence known as the Troubles. Observers fear that reimposing border controls could revive tensions.

But on Monday the Democratic Unionist Party, a faction that is crucial to the ability of Mrs. May’s Conservatives to command a majority in Parliament, rejected that compromise.

Party members acknowledge the case for continued economic links with Ireland, but are deeply suspicious of any proposals that would confer a special status on Northern Ireland, for fear of eventually making it possible for a United Ireland to emerge.

The party’s leader, Arlene Foster, told reporters that her party rejected any “regulatory divergence, which separates Northern Ireland economically, or politically, from the rest of the U.K.” Sammy Wilson, a lawmaker for the Democratic Unionist Party, described the rumored deal as a “threat” to the United Kingdom and as “mad negotiating.”

Mrs. May had consulted with the party, but appeared to have miscalculated what it would accept. At one point Mrs. May broke off from talks with Jean-Claude Juncker, the president of the European Commission, to take a call from Ms. Foster, which highlighted the uncertainty and abruptness of the decision.

If the party were to withdraw its support from Mrs. May’s Conservatives altogether, that could topple the government and bring the Labour Party into power. It could also lead to a new general election, in a country that is exhausted from voting after a national election in 2015, the Brexit referendum last year and another general election this year.

Ireland’s leader, Prime Minister Leo Varadkar, said he was “surprised and disappointed” about the latest developments, given that Mrs. May had agreed to support the draft text in principle only a day earlier.

What happens next is anyone’s guess.

Mrs. May tried to make the best of the situation, announcing that talks would resume later in the week and that she was “confident we will conclude this positively.”

Mrs. May may hope that she can bring the Democratic Unionist Party on board. Failing that, Ireland could give in and agree to to move to trade talks without the guarantees it wants, perhaps under pressure from the rest of the European Union. Or Mrs. May could agree to a deal without the Democratic Unionist Party, risking her parliamentary majority.

If there is no agreement reached to start the next phase of the Brexit talks, it would be nearly impossible to achieve a trade deal by March 2019, the deadline for completion of the process.

The move by the Democratic Unionist Party revealed the extent to which Brexit has fractured Britain along regional lines.

The rumored deal on the border with Ireland immediately set off an outcry in Scotland and in London, where a majority of voters voted to remain in the European Union.

Nicola Sturgeon, Scotland’s first minister, demanded treatment similar to that Mrs. May proposed for Northern Ireland. London’s mayor, Sadiq Khan, made the same case for his city, the majority of whose voters also opposed Brexit.

“Londoners overwhelmingly voted to remain in the EU and a similar deal here could protect tens of thousands of jobs,” he wrote on Twitter.

In the referendum, Northern Ireland also narrowly voted to remain in the European Union, but the territory was sharply divided, with heavily Protestant areas generally favoring Brexit while predominantly Catholic areas voting to remain in the bloc.

Meanwhile some of Mrs. May’s own Conservative Party lawmakers are unhappy about the conduct of the negotiations, with several complaining that — so far — all the major concessions appear to have been made by the prime minister.

The biggest beneficiary of the situation appears to be the main opposition, the Labour Party. Its hard-left leader, Jeremy Corbyn, who has positioned himself as a prime minister in waiting, said the collapse of the draft agreement “provides further evidence that Theresa May’s government is completely ill-equipped to negotiate a successful deal for our country.”